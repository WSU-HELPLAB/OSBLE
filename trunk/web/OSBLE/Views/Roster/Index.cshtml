@using OSBLE.Controllers;
@model IEnumerable<OSBLE.Models.CoursesUsers>
@{
    ViewBag.Title = "Index";
}
<h2>
    Roster</h2>
<p>
    @Html.ActionLink("Add By ID", "Create")&nbsp;&nbsp;
    @Html.ActionLink("Import Roster", "ImportRoster")
</p>
<p>
    Quick Filter By Name: <input type="text" id="roster_find" />
</p>
@* Hides anything that doesn't match search filter *@

<script type="text/javascript">
    if ("Cat".match(".*as")) alert('hi');
    $('#roster_find').keyup(function () {
        // Get search string and remove all non-alphanumeric characters (or dashes)
        var search = $('#roster_find').val().toLowerCase().replace(/[^a-z0-9\-\ ]*/gi, "");

        $('.roster_name').each(function () {
            if ($(this).html().toLowerCase().match(search)) {
                $(this).parent().show('highlight');
            } else {
                $(this).parent().hide('highlight');
            }
        });

    });
</script>

@foreach (RosterController.UsersBySection usersBySection in ViewBag.UsersBySections)
{ 
  <h3>@Helpers.DisplaySection(usersBySection.SectionNumber) </h3>
<table class="roster_table">
    <tr>
        @foreach (RosterController.UsersByRole userByRole in usersBySection.UsersByRole)
        {
            if (userByRole.Count > 0)
            { 
            <td>
                <h3>@userByRole.RoleName (@userByRole.Count.ToString())
                </h3>
                <ul class="user_list">
                    @foreach (OSBLE.Models.UserProfile user in userByRole.Users)
                    {
                        <li>
                        @if ((user != ViewBag.CurrentUser) || ViewBag.CanEditSelf == true)
                        {
                            <div class="user_controls">
                            @if(user.UserName != null) {
                            <a href="@Url.Action("Create", "Mail", new { recipientID = user.ID })">@Helpers.MailButton()</a>
                            }
                            <a href="@Url.Action("Edit", "Roster", new { userProfileID = user.ID })">@Helpers.EditButton()</a>
                            <a href="@Url.Action("Delete", "Roster", new { userProfileID = user.ID })">@Helpers.DeleteButton()</a>
                            
                            </div>
                        }
                        
                        @Helpers.SmallProfilePicture(@Url.Action("ProfilePicture",new {userProfile = user.ID}))
                        <span class="roster_name">@Helpers.DisplayFullNameOrPending(user)</span>
                        
                        </li>
                    }
                </ul>
            </td>
            }
        }
    </tr>
</table>
}
