@model OSBLE.Models.Users.Mail
@using OSBLE.Models

@{
    ViewBag.Title = "Create";
}

<h2>New Message</h2>

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>

@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)

         <a>To:</a>
        <input id="people_finder" />
        @Helpers.CreateToolTip(ToolTips.MailRecipient) <br />
        <script type="text/javascript">

            $("#people_finder").autocomplete({
                source: "@(Url.Action("Search"))",
                select: function(event, ui) {
                    location.href="@Url.Action("Create")?recipientID=" + ui.item.value;
                },
                focus: function(event, ui) {return false;}
            }).data("autocomplete")._renderItem = function( ul, item ) {
                return $( "<li></li>" )
                .data( "item.autocomplete", item )
                .append( "<a>" + "<img src=\"@Url.Action("ProfilePicture")/" + item.value + "\" class=\"small_profile_picture\" alt=\"Profile Picture\" /> " + item.label+ "</a>" )
                .appendTo( ul );
            }
        </script>

        if (Model.ToUserProfile != null)
        {
                @Helpers.ProfilePicture(@Url.Action("ProfilePicture", new { ID = Model.ToUserProfileID }))

                <div class="editor-field">
                    @Model.ToUserProfile.FirstName @Model.ToUserProfile.LastName
                    @Html.HiddenFor(model => model.FromUserProfileID)
                    @Html.ValidationMessageFor(model => model.ToUserProfileID)
                </div>
        }
        //<br />
        <div class="editor-field" style="clear: both;">
            @Html.LabelFor(model => model.Subject): @Html.EditorFor(model => model.Subject)<br />
            @Html.ValidationMessageFor(model => model.Subject)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.Message)
        </div>
        <div class="editor-field">
            @Html.TextAreaFor(model => model.Message, new { @id = "send_mail_textarea" })<br />
            @Html.ValidationMessageFor(model => model.Message)
        </div>

        <p>
            <input type="submit" value="Send Message" />
        </p>
}

<div>
    @Html.ActionLink("Back to Inbox", "Index")
</div>
