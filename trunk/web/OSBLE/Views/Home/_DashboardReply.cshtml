@using OSBLE.Models;
@{
    DashboardReply dr = ViewBag.dr;
    DashboardPost dp = ViewBag.dp;
}
<div class="dp_post @if(ViewBag.hideReply != null) {<text>dp_new_post</text>}" id="dr_reply_@(dr.ID)" >
                        <div class="dp_post_header">
                        <script>
                        @* Updates maximum reply for this post so new replies can return any interim posts. *@
                        $(function() {
                            $('#latest_reply_@(dp.ID)').val(Math.max($('#latest_reply_@(dp.ID)').val(),@(dr.ID)));
                        });
                        </script>

                            @* Profile Picture *@

                            @if (dr.ShowProfilePicture)
                            {
                                @Helpers.ProfilePicture(Url.Action("ProfilePictureForDashboard", new { course = dp.CourseID, userprofile = dr.UserProfileID }));
                            }
                            else
                            {
                                @Helpers.DefaultProfilePicture();
                            }


                            @* Poster's Name *@

                            @Helpers.DisplayNameForDashboard(dr)

                            @* Mail and Delete Buttons *@

                            <span class="dp_tools">
                            @if (dr.CanMail)
                            {
                                <a href="@Url.Action("Create", "Mail", new { recipientID = dr.UserProfileID })">@Helpers.MailButton()</a>
                            }
                            @if (dr.CanDelete)
                            {
                                @* AJAX Delete Call. On success, remove the reply from display. *@
                                <form action="@Url.Action("DeleteReply")"
                                    style="display: inline;"
                                    data-ajax="true"
                                    data-ajax-success="$('#dr_reply_@(dr.ID)').hide('blind',{},'slow',function(){$(this).remove();})"
                                    data-ajax-confirm="Are you sure you want to delete this reply?"
                                    method="post">
                                    <input type="hidden" name="ID" value="@dr.ID" />
                                    @Helpers.DeleteSubmit()
                                </form>
                            }
                            </span>
                            <br />

                            @* Posting Date *@

                            <span class="dp_posted">@Helpers.DisplayDate(dr.Posted)</span>
                        </div>

                        @* Reply Content *@

                        <div class="dp_content">@Helpers.Linkify(dr.Content)</div>
                    </div>